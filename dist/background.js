import{s as a}from"./assets/SyncManager-DKmU1sbf.js";const l=90,d=24*60*60*1e3;async function u(t=l){const o=Date.now()-t*24*60*60*1e3,e=await chrome.storage.local.get(["posts","pendingPosts"]),n=e.posts||[],i=e.pendingPosts||[],g=new Set(i.map(s=>s.id)),c=n.filter(s=>g.has(s.id)?!0:s.scrapedAt>o),r=n.length-c.length;return r>0&&(await chrome.storage.local.set({posts:c}),console.log(`[Cleanup] Cleaned ${r} old posts (kept ${c.length})`)),r}function p(){console.log(`[Cleanup] Starting auto cleanup (check interval: 24h, retention: ${l} days)`),u(),setInterval(()=>u(),d)}a.startAutoSync();p();chrome.runtime.onMessage.addListener((t,o,e)=>{if(console.log("[Background] Received message:",t),t.type==="POSTS_SCRAPED")return h(t.posts).then(e).catch(n=>{e({success:!1,error:n.message})}),!0;if(t.type==="RUN_FILTER")return f().then(e).catch(n=>{e({success:!1,error:n.message})}),!0;if(t.type==="GET_SYNC_STATUS"){const n=a.getStatus();return e({success:!0,status:n}),!0}});async function h(t){console.log(`[Background] Received ${t.length} posts`);const e=(await chrome.storage.local.get("pendingPosts")).pendingPosts||[];return await chrome.storage.local.set({pendingPosts:[...e,...t],syncStatus:"pending"}),a.syncPendingData(),{success:!0,count:t.length}}async function f(){return{success:!1,error:"Not implemented"}}console.log("[Background] Service worker started, auto-sync enabled");
